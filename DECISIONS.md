# ⚖️ 核心决策日志 (v2.0)

> **人类专用**: 本文档记录了项目中最重要、最不可轻易更改的核心决策。在对架构或核心功能提出任何修改建议前，AI必须查阅此文档。

## 决策模板

```markdown
### [决策标题]

- **决策ID**: D[XXX]
- **决策日期**: YYYY-MM-DD
- **决策内容**: [清晰地描述最终的决策]。
- **决策理由**: [简要说明为什么做出这个决策，以及它解决了什么问题]。
- **影响范围**: [说明此决策对哪些模块或流程有影响]。
```

---

## 核心架构决策

### 采用“应用装置”模型
- **决策ID**: D001
- **决策日期**: 2025-08-06
- **决策内容**: CodeRunner 的核心产品是“应用装置 (Appliance)”，即基于 AgentSphere 的预定义沙箱模板（如 Node.js 模板、PostgreSQL 模板）。整个后端服务是一个围绕 AgentSphere SDK 的“业务流程编排器”。
- **决策理由**: 此模型极大地简化了系统架构，降低了开发复杂性，并能充分利用 AgentSphere 的能力。
- **影响范围**: 全局。这是 `01-system-design.md` v2.0 的核心基础。

### 使用 PostgreSQL 存储自身状态
- **决策ID**: D002
- **决策日期**: 2025-08-06
- **决策内容**: CodeRunner 自身的用户、项目、部署等元数据，将存储在 PostgreSQL 数据库中。
- **决策理由**: 关系型数据库非常适合管理实体间的清晰关系，且 PostgreSQL 功能强大、稳定可靠。
- **影响范围**: 所有服务的数据库交互层，具体见 `04-database-schema.md`。

---

## 核心产品决策

### 选择 LowDB v7 作为 Manifest 生成项目的数据库
- **决策ID**: D003
- **决策日期**: 2025-08-07
- **决策内容**: ManifestEngine 生成的所有项目将使用 LowDB v7 作为数据存储方案，而非 SQLite 或其他数据库。
- **决策理由**: LowDB 是纯 JavaScript 实现，无需编译原生依赖，完美适配 AgentSphere 沙箱环境。零配置即可使用，JSON 格式便于调试，对 MVP/POC 项目性能足够。
- **影响范围**: 所有通过 Manifest YAML 生成的项目。未来可在 Phase 2 提供其他数据库选项。

### ManifestEngine 生成 JavaScript 而非 TypeScript
- **决策ID**: D004
- **决策日期**: 2025-08-07
- **决策内容**: ManifestEngine 生成纯 JavaScript (CommonJS) 代码，而非 TypeScript。
- **决策理由**: 沙箱环境中无需编译步骤，减少依赖和复杂性，启动时间更快。对于 MVP 阶段的快速原型开发更加合适。
- **影响范围**: ManifestEngine 的代码生成逻辑。Phase 2 可考虑添加 TypeScript 输出选项。

### MVP 范围明确界定
- **决策ID**: D005
- **决策日期**: 2025-08-07
- **决策内容**: Phase 1 MVP 仅支持基础 CRUD 功能，不包含认证、GraphQL、WebSocket、数据关系等高级特性。
- **决策理由**: 专注核心价值（YAML→后端转换），快速验证产品概念，降低初期复杂度。
- **影响范围**: ManifestEngine 功能范围，用户期望管理，产品路线图规划。
