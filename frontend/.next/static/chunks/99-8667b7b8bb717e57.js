"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99],{1124:(e,t,o)=>{o.d(t,{n:()=>i});var n=o(5453),r=o(6786),s=o(7383),c=o(1886),a=o(5495);let i=(0,n.v)()((0,r.Zr)((e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,login:async(t,o)=>{e({isLoading:!0,error:null});try{let{token:n,userId:r}=(await c.A.post("/auth/login",{email:t,password:o})).data;s.A.set("auth-token",n,{expires:7}),localStorage.setItem("auth-token",n),c.A.defaults.headers.common.Authorization="Bearer ".concat(n),e({token:n,user:{id:r,email:t,planType:"free"},isAuthenticated:!0,isLoading:!1,error:null});try{let e=a.X.getState();await e.connectWebSocket(n)}catch(e){console.warn("Failed to connect WebSocket after login:",e)}}catch(t){var n,r;throw e({isLoading:!1,error:(null===(r=t.response)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.error)||"Login failed"}),t}},register:async(o,n)=>{e({isLoading:!0,error:null});try{let{userId:e}=(await c.A.post("/auth/register",{email:o,password:n})).data;await t().login(o,n)}catch(t){var r,s;throw e({isLoading:!1,error:(null===(s=t.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.error)||"Registration failed"}),t}},logout:()=>{try{a.X.getState().disconnectWebSocket()}catch(e){console.warn("Failed to disconnect WebSocket during logout:",e)}s.A.remove("auth-token"),localStorage.removeItem("auth-token"),delete c.A.defaults.headers.common.Authorization,e({user:null,token:null,isAuthenticated:!1,error:null})},checkAuth:async()=>{let o=s.A.get("auth-token")||localStorage.getItem("auth-token");if(!o){e({isAuthenticated:!1});return}c.A.defaults.headers.common.Authorization="Bearer ".concat(o);try{let t=await c.A.get("/auth/verify");e({token:o,user:t.data.user,isAuthenticated:!0});try{let e=a.X.getState();e.isWebSocketConnected||await e.connectWebSocket(o)}catch(e){console.warn("Failed to connect WebSocket after auth check:",e)}}catch(e){t().logout()}},clearError:()=>e({error:null})}),{name:"auth-storage",partialize:e=>({token:e.token,user:e.user})}))},1886:(e,t,o)=>{o.d(t,{A:()=>a,m:()=>c});var n=o(3464),r=o(7383);let s=n.A.create({baseURL:"http://localhost:8080/api",timeout:3e4,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{let t=r.A.get("auth-token")||localStorage.getItem("auth-token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,async e=>{var t;let o=e.config;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&!o._retry&&(o._retry=!0,r.A.remove("auth-token"),localStorage.removeItem("auth-token"),window.location.href="/auth"),Promise.reject(e)});let c={auth:{login:(e,t)=>s.post("/auth/login",{email:e,password:t}),register:(e,t)=>s.post("/auth/register",{email:e,password:t}),verify:()=>s.get("/auth/verify"),logout:()=>s.post("/auth/logout")},deployments:{list:()=>s.get("/deployments"),get:e=>s.get("/deployments/".concat(e)),create:e=>s.post("/deploy",e),delete:e=>s.delete("/deployments/".concat(e)),control:(e,t)=>s.post("/deployments/".concat(e,"/").concat(t)),logs:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return s.get("/websocket/deployments/".concat(e,"/logs?tail=").concat(t))},metrics:e=>s.get("/metrics/deployment/".concat(e))},projects:{list:()=>s.get("/projects"),get:e=>s.get("/projects/".concat(e)),create:e=>s.post("/projects",e),update:(e,t)=>s.put("/projects/".concat(e),t),delete:e=>s.delete("/projects/".concat(e))},databases:{listDeployments:()=>s.get("/orchestrator/deployments"),getDeployment:e=>s.get("/orchestrator/deployments/".concat(e)),deploy:e=>s.post("/orchestrator/deploy",e),deleteDeployment:e=>s.delete("/orchestrator/deployments/".concat(e)),listTemplates:()=>s.get("/orchestrator/templates"),getTemplate:e=>s.get("/orchestrator/templates/".concat(e)),listTenants:e=>s.get("/orchestrator/".concat(e,"/tenants")),createTenant:(e,t)=>s.post("/orchestrator/".concat(e,"/tenants"),t),deleteTenant:(e,t)=>s.delete("/orchestrator/".concat(e,"/tenants/").concat(t)),listBackups:e=>s.get("/orchestrator/".concat(e,"/backups")),createBackup:(e,t)=>s.post("/orchestrator/".concat(e,"/backups"),t),restoreBackup:(e,t)=>s.post("/orchestrator/".concat(e,"/backups/").concat(t,"/restore")),deleteBackup:(e,t)=>s.delete("/orchestrator/".concat(e,"/backups/").concat(t)),getMetrics:e=>s.get("/orchestrator/".concat(e,"/metrics"))},system:{health:()=>s.get("/health"),metrics:()=>s.get("/metrics/current"),status:()=>s.get("/websocket/status")}},a=s},3999:(e,t,o)=>{o.d(t,{cn:()=>s});var n=o(2596),r=o(9688);function s(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,r.QP)((0,n.$)(t))}},5495:(e,t,o)=>{o.d(t,{X:()=>i});var n=o(5453),r=o(1886),s=o(4298);class c{connect(e){return new Promise((t,o)=>{var n;if(this.state.connecting||(null===(n=this.socket)||void 0===n?void 0:n.connected))return t();this.token=e,this.state.connecting=!0,this.state.error=null;let r="http://localhost:8080/api".replace(/^https?/,"ws")||"ws://localhost:8081";console.log("\uD83D\uDD0C Connecting to WebSocket: ".concat(r)),this.socket=(0,s.io)(r,{transports:["websocket"],timeout:this.connectionTimeout,auth:{token:e},reconnection:!1}),this.socket.on("connect",()=>{this.handleConnect(),t()}),this.socket.on("disconnect",this.handleDisconnect),this.socket.on("connect_error",e=>{this.handleError(e),o(e)}),this.socket.on("error",this.handleError),this.setupEventListeners();let c=setTimeout(()=>{this.state.connecting&&(this.handleError(Error("Connection timeout")),o(Error("Connection timeout")))},this.connectionTimeout);this.socket.on("connect",()=>clearTimeout(c))})}disconnect(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.stopHeartbeat(),this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.state={connected:!1,connecting:!1,error:null,reconnectAttempts:0,subscriptions:new Set},console.log("\uD83D\uDD0C WebSocket disconnected"),this.emit("connection:status",{connected:!1,timestamp:new Date().toISOString()})}subscribeToDeployment(e){var t;if(!(null===(t=this.socket)||void 0===t?void 0:t.connected)){console.warn("Cannot subscribe: WebSocket not connected");return}!this.state.subscriptions.has(e)&&(console.log("\uD83D\uDCE1 Subscribing to deployment: ".concat(e)),this.socket.emit("subscribe:deployment",{deploymentId:e}),this.state.subscriptions.add(e))}unsubscribeFromDeployment(e){var t;(null===(t=this.socket)||void 0===t?void 0:t.connected)&&this.state.subscriptions.has(e)&&(console.log("\uD83D\uDCE1 Unsubscribing from deployment: ".concat(e)),this.socket.emit("unsubscribe:deployment",{deploymentId:e}),this.state.subscriptions.delete(e))}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t)}off(e,t){let o=this.eventHandlers.get(e);o&&o.delete(t)}emit(e,t){let o=this.eventHandlers.get(e);o&&o.forEach(o=>{try{o(t)}catch(t){console.error("Error in WebSocket event handler for ".concat(e,":"),t)}})}getState(){return{...this.state}}isConnected(){var e;return this.state.connected&&(null===(e=this.socket)||void 0===e?void 0:e.connected)===!0}getSubscriptions(){return Array.from(this.state.subscriptions)}handleConnect(){console.log("✅ WebSocket connected successfully"),this.state={...this.state,connected:!0,connecting:!1,error:null,reconnectAttempts:0},this.startHeartbeat(),this.emit("connection:status",{connected:!0,timestamp:new Date().toISOString()}),this.state.subscriptions.forEach(e=>{var t;null===(t=this.socket)||void 0===t||t.emit("subscribe:deployment",{deploymentId:e})})}handleDisconnect(e){console.log("\uD83D\uDD0C WebSocket disconnected: ".concat(e)),this.state.connected=!1,this.state.connecting=!1,this.stopHeartbeat(),this.emit("connection:status",{connected:!1,timestamp:new Date().toISOString()}),"io client disconnect"!==e&&this.token&&this.scheduleReconnect()}handleError(e){console.error("❌ WebSocket error:",e),this.state.connecting=!1,this.state.error=e.message||"WebSocket connection failed",this.token&&this.scheduleReconnect()}scheduleReconnect(){if(this.state.reconnectAttempts>=this.maxReconnectAttempts){console.error("❌ Max reconnection attempts reached"),this.state.error="Max reconnection attempts reached";return}if(this.reconnectTimer)return;let e=Math.min(this.reconnectDelay*Math.pow(2,this.state.reconnectAttempts),3e4);console.log("\uD83D\uDD04 Scheduling reconnect in ".concat(e,"ms (attempt ").concat(this.state.reconnectAttempts+1,")")),this.reconnectTimer=setTimeout(async()=>{if(this.reconnectTimer=null,this.state.reconnectAttempts++,this.token)try{await this.connect(this.token)}catch(e){console.error("Reconnection failed:",e)}},e)}setupEventListeners(){this.socket&&(this.socket.on("deployment:log",e=>{this.emit("deployment:log",e)}),this.socket.on("deployment:status",e=>{this.emit("deployment:status",e)}),this.socket.on("deployment:metrics",e=>{this.emit("deployment:metrics",e)}),this.socket.on("deployment:error",e=>{this.emit("deployment:error",e)}),this.socket.on("health:status",e=>{this.emit("health:status",e)}),this.socket.on("heartbeat:pong",()=>{}))}startHeartbeat(){this.stopHeartbeat(),this.heartbeatTimer=setInterval(()=>{var e;(null===(e=this.socket)||void 0===e?void 0:e.connected)&&this.socket.emit("heartbeat:ping")},this.heartbeatInterval)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}constructor(){this.socket=null,this.token=null,this.reconnectTimer=null,this.heartbeatTimer=null,this.eventHandlers=new Map,this.state={connected:!1,connecting:!1,error:null,reconnectAttempts:0,subscriptions:new Set},this.maxReconnectAttempts=10,this.reconnectDelay=1e3,this.heartbeatInterval=3e4,this.connectionTimeout=5e3,this.connect=this.connect.bind(this),this.disconnect=this.disconnect.bind(this),this.handleConnect=this.handleConnect.bind(this),this.handleDisconnect=this.handleDisconnect.bind(this),this.handleError=this.handleError.bind(this),this.startHeartbeat=this.startHeartbeat.bind(this),this.stopHeartbeat=this.stopHeartbeat.bind(this)}}let a=new c,i=(0,n.v)((e,t)=>({deployments:[],currentDeployment:null,logs:new Map,isLoading:!1,error:null,isWebSocketConnected:!1,wsError:null,fetchDeployments:async()=>{e({isLoading:!0,error:null});try{let t=await r.A.get("/deployments");e({deployments:t.data.deployments||[],isLoading:!1})}catch(n){var t,o;e({isLoading:!1,error:(null===(o=n.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.error)||"Failed to fetch deployments"})}},fetchDeployment:async t=>{e({isLoading:!0,error:null});try{let o=await r.A.get("/deployments/".concat(t));e({currentDeployment:o.data.deployment,isLoading:!1})}catch(t){var o,n;e({isLoading:!1,error:(null===(n=t.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.error)||"Failed to fetch deployment"})}},createDeployment:async t=>{e({isLoading:!0,error:null});try{let o=t.get("projectName"),n=t.get("projectDescription"),s=t.get("runtimeType"),c=(await r.A.post("/deploy",{projectName:o,projectDescription:n,runtimeType:s,files:[],config:{env:{},port:8080}})).data.deployment;return e(e=>({deployments:[...e.deployments,c],isLoading:!1})),c}catch(t){var o,n;throw e({isLoading:!1,error:(null===(n=t.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.error)||"Failed to create deployment"}),t}},deleteDeployment:async t=>{e({isLoading:!0,error:null});try{await r.A.delete("/deployments/".concat(t)),e(e=>({deployments:e.deployments.filter(e=>e.id!==t),isLoading:!1}))}catch(t){var o,n;e({isLoading:!1,error:(null===(n=t.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.error)||"Failed to delete deployment"})}},controlDeployment:async(o,n)=>{e({isLoading:!0,error:null});try{await r.A.post("/deployments/".concat(o,"/").concat(n)),await t().fetchDeployment(o)}catch(t){var s,c;e({isLoading:!1,error:(null===(c=t.response)||void 0===c?void 0:null===(s=c.data)||void 0===s?void 0:s.error)||"Failed to ".concat(n," deployment")})}},connectWebSocket:async o=>{try{a.on("connection:status",t=>{e({isWebSocketConnected:t.connected,wsError:t.connected?null:"Connection lost"})}),a.on("deployment:status",e=>{t().updateDeploymentStatus(e.deploymentId,e.status)}),a.on("deployment:log",e=>{t().addLog(e.deploymentId,e)}),a.on("deployment:metrics",t=>{e(e=>({deployments:e.deployments.map(e=>e.id===t.deploymentId?{...e,cpu:t.cpu,memory:t.memory,network:t.network}:e)}))}),a.on("deployment:error",t=>{console.error("Deployment ".concat(t.deploymentId," error:"),t.error),e({wsError:t.error})}),await a.connect(o),e({isWebSocketConnected:!0,wsError:null})}catch(t){throw console.error("Failed to connect WebSocket:",t),e({isWebSocketConnected:!1,wsError:t.message}),t}},disconnectWebSocket:()=>{a.disconnect(),e({isWebSocketConnected:!1,wsError:null})},subscribeToDeployment:e=>{a.subscribeToDeployment(e)},unsubscribeFromDeployment:e=>{a.unsubscribeFromDeployment(e)},fetchDeploymentLogs:async t=>{try{let o=(await r.A.get("/websocket/deployments/".concat(t,"/logs"))).data.data.logs||[];e(e=>{let n=new Map(e.logs);return n.set(t,o),{logs:n}})}catch(r){var o,n;console.error("Failed to fetch logs for deployment ".concat(t,":"),r),e({error:(null===(n=r.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.error)||"Failed to fetch logs"})}},clearError:()=>e({error:null}),updateDeploymentStatus:(t,o)=>{e(e=>{var n;return{deployments:e.deployments.map(e=>e.id===t?{...e,status:o}:e),currentDeployment:(null===(n=e.currentDeployment)||void 0===n?void 0:n.id)===t?{...e.currentDeployment,status:o}:e.currentDeployment}})},addLog:(t,o)=>{e(e=>{let n=new Map(e.logs),r=n.get(t)||[],s={...o,timestamp:o.timestamp||new Date().toISOString()};return r.push(s),r.length>1e3&&r.shift(),r.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),n.set(t,r),{logs:n}})}}))},7168:(e,t,o)=>{o.d(t,{$:()=>l});var n=o(5155),r=o(2115),s=o(6634),c=o(2085),a=o(3999);let i=(0,c.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=r.forwardRef((e,t)=>{let{className:o,variant:r,size:c,asChild:l=!1,...d}=e,u=l?s.DX:"button";return(0,n.jsx)(u,{className:(0,a.cn)(i({variant:r,size:c,className:o})),ref:t,...d})});l.displayName="Button"},8482:(e,t,o)=>{o.d(t,{Wu:()=>l,ZB:()=>i,Zp:()=>c,aR:()=>a});var n=o(5155),r=o(2115),s=o(3999);let c=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",o),...r})});c.displayName="Card";let a=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",o),...r})});a.displayName="CardHeader";let i=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",o),...r})});i.displayName="CardTitle",r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",o),...r})}).displayName="CardDescription";let l=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",o),...r})});l.displayName="CardContent",r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",o),...r})}).displayName="CardFooter"},9852:(e,t,o)=>{o.d(t,{p:()=>c});var n=o(5155),r=o(2115),s=o(3999);let c=r.forwardRef((e,t)=>{let{className:o,type:r,...c}=e;return(0,n.jsx)("input",{type:r,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",o),ref:t,...c})});c.displayName="Input"}}]);